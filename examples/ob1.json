{
    "@": "PrettyPFA document",
    "action": [
        {
            "@": "PrettyPFA lines 40-75",
            "if": {
                "==": [
                    {
                        "@": "PrettyPFA line 40",
                        "attr": "input",
                        "path": [
                            {
                                "@": "PrettyPFA line 40",
                                "string": "symbol"
                            }
                        ]
                    },
                    {
                        "@": "PrettyPFA line 40",
                        "string": "ESU1"
                    }
                ],
                "@": "PrettyPFA line 40"
            },
            "then": [
                {
                    "@": "PrettyPFA line 41",
                    "let": {
                        "level": {
                            "-": [
                                {
                                    "@": "PrettyPFA line 41",
                                    "attr": "input",
                                    "path": [
                                        {
                                            "@": "PrettyPFA line 41",
                                            "string": "priceLevel"
                                        }
                                    ]
                                },
                                1
                            ],
                            "@": "PrettyPFA line 41"
                        }
                    }
                },
                {
                    "@": "PrettyPFA lines 44-66",
                    "cond": [
                        {
                            "@": "PrettyPFA lines 44-66",
                            "if": {
                                "==": [
                                    {
                                        "@": "PrettyPFA line 44",
                                        "attr": "input",
                                        "path": [
                                            {
                                                "@": "PrettyPFA line 44",
                                                "string": "action"
                                            }
                                        ]
                                    },
                                    {
                                        "@": "PrettyPFA line 44",
                                        "string": "NEW"
                                    }
                                ],
                                "@": "PrettyPFA line 44"
                            },
                            "then": [
                                {
                                    "@": "PrettyPFA line 45",
                                    "cell": "lastUpdate",
                                    "to": {
                                        "@": "PrettyPFA line 45",
                                        "attr": "input",
                                        "path": [
                                            {
                                                "@": "PrettyPFA line 45",
                                                "string": "timestamp"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "@": "PrettyPFA line 46",
                                    "let": {
                                        "l": {
                                            "@": "PrettyPFA line 46",
                                            "new": {
                                                "orderCount": {
                                                    "@": "PrettyPFA line 46",
                                                    "attr": "input",
                                                    "path": [
                                                        {
                                                            "@": "PrettyPFA line 46",
                                                            "string": "orderCount"
                                                        }
                                                    ]
                                                },
                                                "price": {
                                                    "@": "PrettyPFA line 46",
                                                    "attr": "input",
                                                    "path": [
                                                        {
                                                            "@": "PrettyPFA line 46",
                                                            "string": "price"
                                                        }
                                                    ]
                                                },
                                                "size": {
                                                    "@": "PrettyPFA line 46",
                                                    "attr": "input",
                                                    "path": [
                                                        {
                                                            "@": "PrettyPFA line 46",
                                                            "string": "size"
                                                        }
                                                    ]
                                                }
                                            },
                                            "type": "Record_1"
                                        }
                                    }
                                },
                                {
                                    "@": "PrettyPFA lines 47-50",
                                    "cond": [
                                        {
                                            "@": "PrettyPFA lines 47-50",
                                            "if": {
                                                "==": [
                                                    {
                                                        "@": "PrettyPFA line 47",
                                                        "attr": "input",
                                                        "path": [
                                                            {
                                                                "@": "PrettyPFA line 47",
                                                                "string": "updateType"
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "@": "PrettyPFA line 47",
                                                        "string": "BID"
                                                    }
                                                ],
                                                "@": "PrettyPFA line 47"
                                            },
                                            "then": [
                                                {
                                                    "@": "PrettyPFA line 48",
                                                    "cell": "bids",
                                                    "to": {
                                                        "@": "PrettyPFA line 48",
                                                        "a.subseq": [
                                                            {
                                                                "@": "PrettyPFA line 48",
                                                                "a.insert": [
                                                                    {
                                                                        "@": "PrettyPFA line 48",
                                                                        "cell": "bids"
                                                                    },
                                                                    "level",
                                                                    "l"
                                                                ]
                                                            },
                                                            0,
                                                            10
                                                        ]
                                                    }
                                                }
                                            ]
                                        },
                                        {
                                            "@": "PrettyPFA lines 47-50",
                                            "if": {
                                                "==": [
                                                    {
                                                        "@": "PrettyPFA line 49",
                                                        "attr": "input",
                                                        "path": [
                                                            {
                                                                "@": "PrettyPFA line 49",
                                                                "string": "updateType"
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "@": "PrettyPFA line 49",
                                                        "string": "OFFER"
                                                    }
                                                ],
                                                "@": "PrettyPFA line 49"
                                            },
                                            "then": [
                                                {
                                                    "@": "PrettyPFA line 50",
                                                    "cell": "offers",
                                                    "to": {
                                                        "@": "PrettyPFA line 50",
                                                        "a.subseq": [
                                                            {
                                                                "@": "PrettyPFA line 50",
                                                                "a.insert": [
                                                                    {
                                                                        "@": "PrettyPFA line 50",
                                                                        "cell": "offers"
                                                                    },
                                                                    "level",
                                                                    "l"
                                                                ]
                                                            },
                                                            0,
                                                            10
                                                        ]
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "@": "PrettyPFA lines 44-66",
                            "if": {
                                "==": [
                                    {
                                        "@": "PrettyPFA line 51",
                                        "attr": "input",
                                        "path": [
                                            {
                                                "@": "PrettyPFA line 51",
                                                "string": "action"
                                            }
                                        ]
                                    },
                                    {
                                        "@": "PrettyPFA line 51",
                                        "string": "CHANGE"
                                    }
                                ],
                                "@": "PrettyPFA line 51"
                            },
                            "then": [
                                {
                                    "@": "PrettyPFA line 52",
                                    "cell": "lastUpdate",
                                    "to": {
                                        "@": "PrettyPFA line 52",
                                        "attr": "input",
                                        "path": [
                                            {
                                                "@": "PrettyPFA line 52",
                                                "string": "timestamp"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "@": "PrettyPFA line 53",
                                    "let": {
                                        "l": {
                                            "@": "PrettyPFA line 53",
                                            "new": {
                                                "orderCount": {
                                                    "@": "PrettyPFA line 53",
                                                    "attr": "input",
                                                    "path": [
                                                        {
                                                            "@": "PrettyPFA line 53",
                                                            "string": "orderCount"
                                                        }
                                                    ]
                                                },
                                                "price": {
                                                    "@": "PrettyPFA line 53",
                                                    "attr": "input",
                                                    "path": [
                                                        {
                                                            "@": "PrettyPFA line 53",
                                                            "string": "price"
                                                        }
                                                    ]
                                                },
                                                "size": {
                                                    "@": "PrettyPFA line 53",
                                                    "attr": "input",
                                                    "path": [
                                                        {
                                                            "@": "PrettyPFA line 53",
                                                            "string": "size"
                                                        }
                                                    ]
                                                }
                                            },
                                            "type": "Record_1"
                                        }
                                    }
                                },
                                {
                                    "@": "PrettyPFA lines 54-57",
                                    "cond": [
                                        {
                                            "@": "PrettyPFA lines 54-57",
                                            "if": {
                                                "==": [
                                                    {
                                                        "@": "PrettyPFA line 54",
                                                        "attr": "input",
                                                        "path": [
                                                            {
                                                                "@": "PrettyPFA line 54",
                                                                "string": "updateType"
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "@": "PrettyPFA line 54",
                                                        "string": "BID"
                                                    }
                                                ],
                                                "@": "PrettyPFA line 54"
                                            },
                                            "then": [
                                                {
                                                    "@": "PrettyPFA line 55",
                                                    "cell": "bids",
                                                    "path": [
                                                        "level"
                                                    ],
                                                    "to": "l"
                                                }
                                            ]
                                        },
                                        {
                                            "@": "PrettyPFA lines 54-57",
                                            "if": {
                                                "==": [
                                                    {
                                                        "@": "PrettyPFA line 56",
                                                        "attr": "input",
                                                        "path": [
                                                            {
                                                                "@": "PrettyPFA line 56",
                                                                "string": "updateType"
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "@": "PrettyPFA line 56",
                                                        "string": "OFFER"
                                                    }
                                                ],
                                                "@": "PrettyPFA line 56"
                                            },
                                            "then": [
                                                {
                                                    "@": "PrettyPFA line 57",
                                                    "cell": "offers",
                                                    "path": [
                                                        "level"
                                                    ],
                                                    "to": "l"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "@": "PrettyPFA lines 44-66",
                            "if": {
                                "==": [
                                    {
                                        "@": "PrettyPFA line 58",
                                        "attr": "input",
                                        "path": [
                                            {
                                                "@": "PrettyPFA line 58",
                                                "string": "action"
                                            }
                                        ]
                                    },
                                    {
                                        "@": "PrettyPFA line 58",
                                        "string": "DELETE"
                                    }
                                ],
                                "@": "PrettyPFA line 58"
                            },
                            "then": [
                                {
                                    "@": "PrettyPFA line 59",
                                    "cell": "lastUpdate",
                                    "to": {
                                        "@": "PrettyPFA line 59",
                                        "attr": "input",
                                        "path": [
                                            {
                                                "@": "PrettyPFA line 59",
                                                "string": "timestamp"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "@": "PrettyPFA line 60",
                                    "let": {
                                        "dummy": {
                                            "@": "PrettyPFA line 60",
                                            "new": {
                                                "orderCount": 0,
                                                "price": {
                                                    "@": "PrettyPFA line 60",
                                                    "string": "-"
                                                },
                                                "size": 0
                                            },
                                            "type": "Record_1"
                                        }
                                    }
                                },
                                {
                                    "@": "PrettyPFA lines 61-65",
                                    "cond": [
                                        {
                                            "@": "PrettyPFA lines 61-65",
                                            "if": {
                                                "==": [
                                                    {
                                                        "@": "PrettyPFA line 61",
                                                        "attr": "input",
                                                        "path": [
                                                            {
                                                                "@": "PrettyPFA line 61",
                                                                "string": "updateType"
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "@": "PrettyPFA line 61",
                                                        "string": "BID"
                                                    }
                                                ],
                                                "@": "PrettyPFA line 61"
                                            },
                                            "then": [
                                                {
                                                    "@": "PrettyPFA line 62",
                                                    "cell": "bids",
                                                    "to": {
                                                        "@": "PrettyPFA line 62",
                                                        "a.append": [
                                                            {
                                                                "@": "PrettyPFA line 62",
                                                                "a.remove": [
                                                                    {
                                                                        "@": "PrettyPFA line 62",
                                                                        "cell": "bids"
                                                                    },
                                                                    "level"
                                                                ]
                                                            },
                                                            "dummy"
                                                        ]
                                                    }
                                                }
                                            ]
                                        },
                                        {
                                            "@": "PrettyPFA lines 61-65",
                                            "if": {
                                                "==": [
                                                    {
                                                        "@": "PrettyPFA line 63",
                                                        "attr": "input",
                                                        "path": [
                                                            {
                                                                "@": "PrettyPFA line 63",
                                                                "string": "updateType"
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "@": "PrettyPFA line 63",
                                                        "string": "OFFER"
                                                    }
                                                ],
                                                "@": "PrettyPFA line 63"
                                            },
                                            "then": [
                                                {
                                                    "@": "PrettyPFA line 64",
                                                    "cell": "offers",
                                                    "to": {
                                                        "@": "PrettyPFA line 64",
                                                        "a.append": [
                                                            {
                                                                "@": "PrettyPFA line 64",
                                                                "a.remove": [
                                                                    {
                                                                        "@": "PrettyPFA line 64",
                                                                        "cell": "offers"
                                                                    },
                                                                    "level"
                                                                ]
                                                            },
                                                            "dummy"
                                                        ]
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "@": "PrettyPFA line 68",
                    "cell": "counter",
                    "to": {
                        "@": "PrettyPFA line 68",
                        "fcn": "u.increment"
                    }
                },
                {
                    "@": "PrettyPFA lines 69-74",
                    "if": {
                        ">=": [
                            {
                                "@": "PrettyPFA line 69",
                                "cell": "counter"
                            },
                            1000
                        ],
                        "@": "PrettyPFA line 69"
                    },
                    "then": [
                        {
                            "@": "PrettyPFA lines 70-72",
                            "emit": [
                                {
                                    "@": "PrettyPFA lines 70-72",
                                    "new": {
                                        "bids": {
                                            "@": "PrettyPFA line 71",
                                            "cell": "bids"
                                        },
                                        "offers": {
                                            "@": "PrettyPFA line 72",
                                            "cell": "offers"
                                        },
                                        "timestamp": {
                                            "@": "PrettyPFA line 70",
                                            "cell": "lastUpdate"
                                        }
                                    },
                                    "type": "Record_2"
                                }
                            ]
                        },
                        {
                            "@": "PrettyPFA line 73",
                            "cell": "counter",
                            "to": 0
                        }
                    ]
                }
            ]
        }
    ],
    "begin": [
        {
            "@": "PrettyPFA line 33",
            "let": {
                "dummy": {
                    "@": "PrettyPFA line 33",
                    "new": {
                        "orderCount": 0,
                        "price": {
                            "@": "PrettyPFA line 33",
                            "string": "-"
                        },
                        "size": 0
                    },
                    "type": "Record_1"
                }
            }
        },
        {
            "do": [
                {
                    "@": "PrettyPFA line 35",
                    "cell": "bids",
                    "to": {
                        "@": "PrettyPFA line 35",
                        "a.append": [
                            {
                                "@": "PrettyPFA line 35",
                                "cell": "bids"
                            },
                            "dummy"
                        ]
                    }
                },
                {
                    "@": "PrettyPFA line 36",
                    "cell": "offers",
                    "to": {
                        "@": "PrettyPFA line 36",
                        "a.append": [
                            {
                                "@": "PrettyPFA line 36",
                                "cell": "offers"
                            },
                            "dummy"
                        ]
                    }
                }
            ],
            "for": {
                "i": 0
            },
            "step": {
                "i": {
                    "+": [
                        "i",
                        1
                    ],
                    "@": "PrettyPFA line 34"
                }
            },
            "while": {
                "<": [
                    "i",
                    10
                ],
                "@": "PrettyPFA line 34"
            }
        }
    ],
    "cells": {
        "bids": {
            "@": "PrettyPFA line 21",
            "init": [],
            "rollback": false,
            "shared": false,
            "type": {
                "items": "Record_1",
                "type": "array"
            }
        },
        "counter": {
            "@": "PrettyPFA line 23",
            "init": 0,
            "rollback": false,
            "shared": false,
            "type": "int"
        },
        "lastUpdate": {
            "@": "PrettyPFA line 20",
            "init": "never",
            "rollback": false,
            "shared": false,
            "type": "string"
        },
        "offers": {
            "@": "PrettyPFA line 22",
            "init": [],
            "rollback": false,
            "shared": false,
            "type": {
                "items": "Record_1",
                "type": "array"
            }
        }
    },
    "fcns": {
        "increment": {
            "do": [
                {
                    "+": [
                        "n",
                        1
                    ],
                    "@": "PrettyPFA line 30"
                }
            ],
            "params": [
                {
                    "n": "int"
                }
            ],
            "ret": "int"
        }
    },
    "input": {
        "fields": [
            {
                "name": "timestamp",
                "type": "string"
            },
            {
                "name": "symbol",
                "type": "string"
            },
            {
                "name": "updateType",
                "type": {
                    "name": "Enum_1",
                    "symbols": [
                        "BID",
                        "OFFER",
                        "TRADE"
                    ],
                    "type": "enum"
                }
            },
            {
                "name": "action",
                "type": {
                    "name": "Enum_2",
                    "symbols": [
                        "NEW",
                        "CHANGE",
                        "DELETE",
                        "OVERLAY"
                    ],
                    "type": "enum"
                }
            },
            {
                "name": "priceLevel",
                "type": "int"
            },
            {
                "name": "price",
                "type": "string"
            },
            {
                "name": "size",
                "type": "int"
            },
            {
                "name": "orderType",
                "type": {
                    "name": "Enum_3",
                    "symbols": [
                        "REGULAR",
                        "IMPLIED"
                    ],
                    "type": "enum"
                }
            },
            {
                "name": "orderCount",
                "type": "int"
            },
            {
                "name": "fixNumber",
                "type": "int"
            }
        ],
        "name": "Record_3",
        "type": "record"
    },
    "method": "emit",
    "name": "Engine_1",
    "output": {
        "fields": [
            {
                "name": "timestamp",
                "type": "string"
            },
            {
                "name": "bids",
                "type": {
                    "items": {
                        "fields": [
                            {
                                "name": "price",
                                "type": "string"
                            },
                            {
                                "name": "size",
                                "type": "int"
                            },
                            {
                                "name": "orderCount",
                                "type": "int"
                            }
                        ],
                        "name": "Record_1",
                        "type": "record"
                    },
                    "type": "array"
                }
            },
            {
                "name": "offers",
                "type": {
                    "items": "Record_1",
                    "type": "array"
                }
            }
        ],
        "name": "Record_2",
        "type": "record"
    }
}
